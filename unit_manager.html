<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unit Manager - LearnEng LMS</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 700px; margin: auto; }
    input, select, button { margin: 8px 0; padding: 10px; width: 100%; font-size: 1em; }
    .form-group { margin-bottom: 15px; }
    #status { margin-top: 20px; color: green; }
  </style>
</head>
<body>
  <h2>Unit Manager</h2>

  <div class="form-group">
    <label for="classCode">Class:</label>
    <select id="classCode">
      <option value="">Select a class</option>
      <option>5A</option><option>5B</option>
      <option>6A</option><option>6B</option>
      <option>7A</option><option>7B</option>
      <option>8A</option><option>8B</option>
    </select>
  </div>

  <div class="form-group">
    <label for="unitTitle">Unit Title:</label>
    <input type="text" id="unitTitle" placeholder="e.g., Unit 2: Teen Life">
  </div>

  <div class="form-group">
    <label for="activityType">Activity Type:</label>
    <select id="activityType">
      <option value="Video">Video</option>
      <option value="Worksheet">Worksheet</option>
      <option value="Quiz">Quiz</option>
      <option value="Game">Game</option>
    </select>
  </div>

  <div class="form-group">
    <label for="activityTitle">Activity Title:</label>
    <input type="text" id="activityTitle" placeholder="e.g., Daily Routine Video">
  </div>

  <div class="form-group">
    <label for="activityURL">Activity URL:</label>
    <input type="text" id="activityURL" placeholder="e.g., https://youtube.com/...">
  </div>

  <button onclick="addActivity()">Add Activity</button>

  <div id="status"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDG1IGyA1GurRmw4xIZxxcZtzHaRJPIiOA",
      authDomain: "learneng-lms.firebaseapp.com",
      projectId: "learneng-lms",
      storageBucket: "learneng-lms.firebasestorage.app",
      messagingSenderId: "685008553747",
      appId: "1:685008553747:web:d1fc6c9dc0cf1f9a407ce6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function addActivity() {
      const classCode = document.getElementById('classCode').value;
      const unitTitle = document.getElementById('unitTitle').value.trim();
      const activityType = document.getElementById('activityType').value;
      const activityTitle = document.getElementById('activityTitle').value.trim();
      const activityURL = document.getElementById('activityURL').value.trim();

      if (!classCode || !unitTitle || !activityTitle || !activityURL) {
        document.getElementById('status').textContent = "Please fill in all fields.";
        return;
      }

      const docRef = doc(db, `units_${classCode}`, unitTitle);
      const docSnap = await getDoc(docRef);
      const activity = { title: activityTitle, url: activityURL };

      if (docSnap.exists()) {
        const updates = {};
        updates[`activityTypes.${activityType}`] = arrayUnion(activity);
        await updateDoc(docRef, updates);
      } else {
        const newData = {
          unit: unitTitle,
          activityTypes: {
            [activityType]: [activity]
          }
        };
        await setDoc(docRef, newData);
      }

      document.getElementById('status').textContent = `✔️ Activity added to ${unitTitle} (${classCode})`;
      document.getElementById('activityTitle').value = "";
      document.getElementById('activityURL').value = "";
    }
  </script>
</body>
</html>